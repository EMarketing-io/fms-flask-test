<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Meeting Summariser</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css', v=config['ASSET_VERSION']) }}">

</head>

<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <span class="dot"></span>
        <span>Meeting Summariser</span>
      </div>
      <span class="badge" title="Files go to Google Drive & metadata to Sheets">Secure Uploads</span>
    </div>

    {% with msgs=get_flashed_messages() %}
    {% if msgs %}
    <div class="alert">âš ï¸ {{ msgs[0] }}</div>
    {% endif %}
    {% endwith %}

    <div class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Submit Meeting Assets</div>
          <div class="card-sub">Upload audio, add metadata, and weâ€™ll route everything automatically.</div>
        </div>
      </div>

      <form class="form" method="POST" enctype="multipart/form-data">
        <div class="grid grid-2">
          <div>
            <label>ğŸ—“ï¸ Meeting Date</label>
            <input class="input" type="date" id="meeting_date" name="meeting_date" required />
          </div>

          <div>
            <label>ğŸ·ï¸ Client Name</label>
            <select class="select" name="client_name" required>
              {% for c in clients %}<option value="{{c}}">{{c}}</option>{% endfor %}
            </select>
          </div>

          <div>
            <label>ğŸ“Œ Meeting Type</label>
            <select class="select" name="meeting_type">
              <option>Regular</option>
              <option>Kickstart</option>
            </select>
          </div>

          <div>
            <label>ğŸ‘¤ Submitted By</label>
            <select class="select" name="submitted_by" id="submitted_by">
              {% for n in employee_names %}<option value="{{n}}">{{n}}</option>{% endfor %}
            </select>
          </div>

          <div>
            <label>âœ‰ï¸ Email (auto)</label>
            <input class="input" type="text" id="email_id" disabled />
            <div class="small">Auto-filled from the dropdown â€” stored with the submission.</div>
          </div>

          <div>
            <label>ğŸŒ Website Link (optional)</label>
            <input class="input" type="url" name="website_link" placeholder="https://example.com" />
          </div>
        </div>

        <div>
          <label>ğŸ™ï¸ Meeting Audio (.m4a/.mp3/.wav)</label>
          <div id="drop" class="filebox">
            <div>
              <strong>Drag & drop files here</strong> or click to choose
              <p>Multiple files supported â€¢ Max limited by server config</p>
            </div>
            <input id="fileInput" type="file" name="audio_files" accept=".m4a,.mp3,.wav" multiple required
              style="opacity:0;position:absolute;inset:0;cursor:pointer">
          </div>
          <ul id="fileList" class="filelist" aria-live="polite"></ul>
        </div>

        <button class="button" type="submit">ğŸš€ Submit</button>
      </form>
    </div>
  </div>

  <script>
    const map = {{ employee_email_map| tojson }};
    const sel = document.getElementById('submitted_by');
    const email = document.getElementById('email_id');
    function upd() { email.value = map[sel.value] || ''; }
    sel.addEventListener('change', upd); upd();
    const drop = document.getElementById('drop');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');

    function listFiles(files) {
      fileList.innerHTML = '';
      [...files].forEach(f => {
        const li = document.createElement('li');
        li.textContent = `â€¢ ${f.name} (${Math.round((f.size / 1024 / 1024) * 100) / 100} MB)`;
        fileList.appendChild(li);
      });
    }

    drop.addEventListener('dragover', e => { e.preventDefault(); drop.classList.add('drag'); });
    drop.addEventListener('dragleave', () => drop.classList.remove('drag'));
    drop.addEventListener('drop', e => {
      e.preventDefault(); drop.classList.remove('drag');
      const dt = e.dataTransfer;
      if (dt && dt.files) {
        fileInput.files = dt.files;
        listFiles(dt.files);
      }
    });
    fileInput.addEventListener('change', e => listFiles(e.target.files));
    const dateInput = document.getElementById('meeting_date');
    const today = new Date().toISOString().split('T')[0];
    dateInput.max = today;
  </script>
</body>

</html>